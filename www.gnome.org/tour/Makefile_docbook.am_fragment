# Before including this fragment,
# set docbook_path to, for instance, docbook/C/
# set html_path to, for instance, C/
 
VERSION = 2.10
ROOTDOC = tour.xml
STYLE_PATH = ../../docbook_html_style/

docbook_sources = $(docbook_path)$(ROOTDOC) $(docbook_path)communication.xml $(docbook_path)sound_and_video.xml \
                  $(docbook_path)controlcenter.xml $(docbook_path)desktop.xml $(docbook_path)docs.xml $(docbook_path)sysadmin.xml \
                  $(docbook_path)i18n.xml $(docbook_path)games.xml $(docbook_path)utilities.xml \
                  $(docbook_path)installation.xml $(docbook_path)platform.xml $(docbook_path)standards.xml

html: $(html_path)index.html

$(html_path)index.html: $(docbook_sources)
	-rm -rf $(html_path)
	mkdir $(html_path)
	-xsltproc --xinclude -o $(html_path) \
		--param yelp_max_chunk_depth 1 \
		--stringparam admon.graphics.path ./images/ \
		--stringparam http_root http://www.gnome.org \
		--stringparam http_prefix /tour/ \
		$(STYLE_PATH)db2html.xsl $(docbook_path)$(ROOTDOC)
	cp -R $(STYLE_PATH)images $(docbook_path)figures $(html_path)
	for i in $(html_path)*.html; do \
		perl -p -i -e 's,<p class="section"></p>,<p class="section">Sections</p>,g' $$i; \
	done

clean:
	-rm -rf $(html_path)

validate: $(docbook_sources)
	xmllint --xinclude --valid --noout --noent --catalogs $<

.PHONY: clean
