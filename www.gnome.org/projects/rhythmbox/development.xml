<?xml version='1.0'?>
<page>
  <title>Development</title>
  <body>
    <h2>Arch</h2>
    <p>Rhythmbox is maintained primarily in the <a href="http://wiki.sourcecontrol.net/">Arch</a>
      revision control system, specifically the <a href="http://www.gnu.org/software/gnu-arch/">tla</a> implementation.</p>
    <dl>
      <dt>Archive Name</dt>
      <dd><p><samp>rhythmbox-devel@gnome.org--2004</samp></p></dd>
      <dt>Archive Location</dt>
      <dd><p><samp>http://web.rhythmbox.org/arch/2004</samp></p></dd>
      <dt>Main development branch</dt>
      <dd><p><samp>rhythmbox--main--0.9</samp></p></dd>
      <dt>Stable branch</dt>
      <dd><p><samp>rhythmbox--main--0.8</samp></p></dd>
    </dl>
    <p class="warningpara">
      IMPORTANT: These instructions <em>require</em> <samp>tla</samp> 1.1 or better.
    </p>
    <p>
      First, if you have never registered the Rhythmbox archive, you should do that now:
    </p>
    <pre>
$ tla register-archive http://web.rhythmbox.org/arch/2004
    </pre>
    <p>
      After doing that (which you only have to do once), you can get a copy of the tree
      like so:
    </p>
    <pre>
$ tla get rhythmbox-devel@gnome.org--2004/rhythmbox--main--0.9
    </pre>
    <h4>Updating the tree</h4>
    <p>To update the source tree, just do:</p>
<pre>
$ tla update
</pre>
    <h3>Known Rhythmbox development archives</h3>
    <p>
      On the IRC channel and in Bugzilla, you will occasionally see references
      to developers' branches of Rhythmbox. One example is:
      <samp>walters@rhythmbox.org--2003b/rhythmbox--main--0.9</samp>. It
      can be hard to find what the <samp>walters@rhythmbox.org--2003b</samp>
      part refers to, so we've provided this handy table of known archives.
      Here's how you might register an archive:
    </p>
<pre>
$ tla register-archive http://arch.example.com/archive
</pre>
    <p>
      tla will then add that archive to your list of registered archives.
    </p>
    <table border="1">
      <tr><th>Archive Name</th><th>Archive Location</th><th>GPG key</th><th>Comments</th></tr>
      <tr><td>rhythmbox-devel@gnome.org--2004</td>
	<td>http://web.rhythmbox.org/arch/2004</td>
        <td><a href="http://web.rhythmbox.org/keyring.gpg">(keyring)</a></td>
	<td>Central archive</td></tr>
      <tr><td>walters@rhythmbox.org--2003b</td>
	<td>http://arch.verbum.org/rhythmbox-2003b</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x6A765865&amp;op=index">6A765865</a></td>
	<td>Maintainer's archive</td></tr>
      <tr><td>desrt@desrt.ca--2003</td>
	<td>http://arch.desrt.ca/</td>
        <td></td>
	<td>song display, misc bugfixes</td></tr>
      <tr><td>harshy@dersoldat.org--2004</td>
	<td>http://arch.dersoldat.org/arch--2004</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0xC828E736&amp;op=index">C828E736</a></td>
	<td>misc bugfixes</td></tr>
      <tr><td><a href="http://bluejay.dyndns.org/cgi-bin/viewarch.cgi/jyasskin@mail.utexas.edu--2003">jyasskin@mail.utexas.edu--2003</a></td>
	<td>http://bluejay.dyndns.org/archives/2003</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x04F49795&amp;op=index">04F49795</a></td>
	<td>Shuffle and random play orders</td></tr>
      <tr><td>sri@aracnet.com--2004</td>
	<td>http://shell.ramki.us/Arch/sri@aracnet.com--2004/</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x7BB80427&amp;op=index">7BB80427</a></td>
	<td>GtkFileChooser fixes, statusbar</td></tr>
      <tr><td>teuf@gnome.org--2003</td>
	<td>http://cfergeau.free.fr/arch/</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x39734ACE&amp;op=index">39734ACE</a></td>
	<td>iPod integration</td></tr>
      <tr><td>teuf@gnome.org--2004</td>
	<td>http://testoo.no-ip.com/~teuf/archive</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x39734ACE&amp;op=index">39734ACE</a></td>
	<td>Various experiments</td></tr>
      <tr><td>treed@surreality.us--2003-rhythmbox</td>
	<td>http://www.surreality.us/arch/rhythmbox</td>
	<td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0xCE1A0CDC&amp;op=index">CE1A0CDC</a></td>
	<td>misc bugfixes</td></tr>
      <tr><td>yann@cvs.gnome.org--2003</td>
	<td>ftp://81.64.184.176/archive</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x2FE51A2E&amp;op=index">2FE51A2E</a></td>
	<td>drag &amp; drop, misc bugfixes</td></tr>
      <tr><td>mterry@fastmail.fm--2004</td>
	<td>http://people.umass.edu/msterry/archive</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x136B762D&amp;op=index">136B762D</a></td>
	<td>automatic rating work</td></tr>
      <tr><td>mfcn@wh-hms.uni-ulm.de--2004</td>
	<td>http://www.wh-hms.uni-ulm.de/~mfcn/archive/</td>
        <td></td>
	<td>album covers</td></tr>
      <tr><td>aeb@debian.org--2004</td>
	<td>http://home.in.tum.de/~bombe/arch/aeb@debian.org--2004</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x04880A44&amp;op=index">04880A44</a></td>
	<td>bugfixes</td></tr>
      <tr><td>daf@muse.19inch.net--2004</td>
	<td>http://muse.19inch.net/~daf/arch/</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0x128287e8&amp;op=index">128287E8</a></td>
	<td>Welsh translation</td></tr>
      <tr><td>david@grepninja.com--2004</td>
	<td>http://arch.grepninja.com</td>
        <td><a href="http://pgp.mit.edu:11371/pks/lookup?search=0xdd0abe82&amp;op=index">DD0ABE82</a></td>
	<td>Xine fixes, iradio work, and more</td></tr>
      <tr><td>jonatan@pnx.se--2004</td>
	<td>http://www.pnx.se/arch</td>
        <td></td>
	<td>DBus remote interface</td></tr>
      <tr><td>mccann@jhu.edu--2004</td>
	<td>http://acs.pha.jhu.edu/~mccannwj/archive/</td>
	<td>31F92888</td>
	<td>CD burning support, various fixes</td></tr>
      <tr><td>m.pavot@laposte.net--2004</td>
	<td>http://perso.enst.fr/~pavot/archive</td>
	<td></td>
	<td>CD cover support</td></tr>
      <tr><td>mattjones@berkeley.edu--2005</td>
	<td>http://triplehelix.org/~matt/archive/</td>
	<td>A783AA84</td>
	<td>Audio CD support</td>
      </tr>
    </table>
    <p>
      One hint: after registering a new archive, you may want to run
    </p>
<pre>
$ tla abrowse jane@example.com--2003
</pre>
    <p>
      This will show you in a nice format what all is in the archive.
    </p>
    <h3>The GNOME CVS</h3>    
    <p>However, not all the developers use Arch right now, so the arch tree is
      regularly synchronized (about once a day) with the <a href="http://developer.gnome.org/tools/cvs.html">GNOME CVS</a>,
      in the <samp>rhythmbox</samp> module.
      See <a href="http://mail.gnome.org/archives/rhythmbox-devel/2003-September/msg00007.html">this message</a> for more information about how things work.
    </p>
    <h2>Creating your own Rhythmbox branch</h2>    
    <p>
      So you'd like to start contributing to Rhythmbox?  Arch makes it incredibly easy.
      You don't need any kind of write access to the GNOME CVS or the main Rhythmbox arch
      tree to start working.  You can create your own local branch of the tree, and
      start hacking on it.
    </p>
    <h3>If you've never used tla before...</h3>    
    <p>
      The very first thing you need to do is tell <samp>tla</samp> what your
      identity is.  Do this, if you've never done it before:
    </p>
<samp>    
$ tla my-id 'Jane Doe &lt;myname@myisp.com&gt;'
</samp>
    <h3>Creating your archive</h3>    
    <p>
      First, if you haven't already, you need to create your own Arch "archive".
      This is your local repository; it can contain many multiple branches
      of various software.
    </p>
    <pre>
$ tla make-archive myname@myisp.com--2003 ~/code/archive
    </pre>
    <p>
      If you have at least tla 1.2pre0 and a gpg key, you may want to sign your
      archive. To do so, use the following command instead.
    </p>
    <pre>
$ tla make-archive --signed myname@myisp.com--2003 ~/code/archive
    </pre>
    <p>
      Then create the file <samp>~/.arch-params/signing/=default</samp>
      containing the line
    </p>
    <pre>
gpg --clearsign
    </pre>
    <h3>Creating a branch</h3>    
    <p>
      Next, you want to create a branch.  At this point, if you didn't register
      the archives above, you should do that now.  You will then make this branch
      refer back to the main Rhythmbox arch repository:
    </p>
    <pre>
$ tla archive-setup myname@myisp.com--2003/rhythmbox--main--0.9
$ tla tag rhythmbox-devel@gnome.org--2004/rhythmbox--main--0.9 myname@myisp.com--2003/rhythmbox--main--0.9
    </pre>
    <p>
      Congratulations, you've created your own branch!  Next, let's get a copy of the
      tree, where we can do work:
    </p>
    <pre>
$ tla get myname@myisp.com--2003/rhythmbox--main--0.9 rhythmbox
    </pre>
    <h3> Updating your branch </h3>
    <p>
      Development on your branch is now entirely independent of development
      on the main Rhythmbox tree.  However, it's likely that you will want
      to merge in changes made on the main Rhythmbox tree.  When you want
      to do that, just do:
    </p>
    <pre>
$ tla star-merge rhythmbox-devel@gnome.org--2004/rhythmbox--main--0.9 
    </pre>
    <h3>Committing changes</h3>    
    <p>
      That's it!  Now, cd into <samp>rhythmbox</samp> and hack away.  When
      you're ready to commit, do this:
    </p>
<pre>
$ tla commit -s 'fix crash on invalid mp3s'
</pre>
    <h3>Publishing your archive</h3>    
    <p>
      That's the basic work cycle.  Now, finally you need to publish your
      changes somewhere.  You do this by creating a <em>mirror</em> of your
      local repository, on a public web site or FTP site, where others
      can read your changes.  You will need write access for yourself to
      the repository; I personally talk to <samp>arch.verbum.org</samp> over SFTP,
      but there are other transports available.
    </p>
<samp>
$ tla make-archive --listing --mirror myname@myisp.com--2003 sftp://myisp.com/home/me/public_html/archive
</samp>
    <p>
      If you have signed your main archive, in order to preserve your
      signatures, the above command should be
    </p>
<pre>
$ tla make-archive --signed --listing --mirror myname@myisp.com--2003 sftp://myisp.com/home/me/public_html/archive
</pre>
    <p>
      And you should create the file
      <samp>~/.arch-params/signing/myname@myisp.com--2003-MIRROR</samp>
      containing the line
    </p>
<samp>
myname@myisp.com--2003
</samp>
    <p>
      In the above command, the directory <samp>archive</samp> must not already exist.
      Now, you want to push the changes in your local repository to the mirror:
    </p>
<samp>
$ tla archive-mirror myname@myisp.com--2003
</samp>
    <p>
      Finally, to publish your changes, you need to tell people how to access your
      public mirror, by giving them the archive name (<samp>myname@myisp.com--2003</samp>)
      and the location (say <samp>http://myisp.com/~me/archive</samp>).
    </p>
    <h3>A bit more advanced: tracking upstream branch changes</h3>    
    <p>
Periodically, a new branch of Rhythmbox will be created for new major versions.
If you have your own branch of an older version, you will likely also want your
own branch of the newer version as well.  <a href="http://mail.gnome.org/archives/rhythmbox-devel/2003-November/msg00108.html">This message</a> describes how to handle that.
  </p>
    <h2>A discussion of Arch and Rhythmbox</h2>
    <p>
      You may find <a href="http://web.verbum.org/files/rhythmbox-arch-irc.log">this IRC discussion</a>
      to be a good introduction to Arch from a newbie perspective.
    </p>
  </body>
</page>
