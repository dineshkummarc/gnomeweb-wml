<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Programming Gnumeric using Python</title><link rel="previous" href="sect-extending-functions.shtml" title="Defining New Functions"/><link rel="next" href="sect-extending-plugins.shtml" title="Writing New Plugins"/><link rel="top" href="index.shtml" title="The Gnumeric Manual, version 1.4"/><link rel="stylesheet" type="text/css" href="gnumeric-doc.css"/></head><body><div class="body"><div class="sect1"><a name="sect-extending-python"/><h1 class="sect1 title"><span class="title">Programming Gnumeric using Python</span></h1><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
    A powerful way to access and manipulate data in
    <span class="application" style="font-style: italic; ">Gnumeric</span> involves using the Python
    programming language. As <span class="application" style="font-style: italic; ">Gnumeric</span>
    develops from version 1.2, the scripting methods will become
    increasingly powerful. Since <span class="application" style="font-style: italic; ">Gnumeric</span>
    is free software, you could extend it directly using the source
    code and adding C language functions to the code. Python offers a
    higher level abstraction through which to interact with the
    spreadsheet.
  </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
    Python and <span class="application" style="font-style: italic; ">Gnumeric</span> can be used in
    several ways. This section will describe how to obtain
    <span class="application" style="font-style: italic; ">Gnumeric</span>, install it and get things
    configured correctly for access with Python. If you already have
    the pieces in place, you can skip the section <a class="xref" href="sect-extending-python.shtml#sect-extending-python-install" title="Installing and Building Gnumeric for Python">Section 13.3.1 ― Installing and Building Gnumeric for Python</a>.
  </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
    This section was written by Charles Twardy. It owes a great deal
    to the nice guide Travis Whitton wrote: <a class="ulink" href="http://grub.ath.cx/gnumeric-python/" title="http://grub.ath.cx/gnumeric-python/">Python/Gnumeric guide
    for the old API in Gnumeric 1.0.</a> Jon Käre Hellan
    contributed most of the code to enable Python in
    <span class="application" style="font-style: italic; ">Gnumeric</span> and wrote the file
    <span class="literal" style="font-family: monospace; ">python-gnumeric.txt</span> in the source
    tree. Nathan Hurst provided the idea and support.
  </p><div class="admonition block-indent warning">
    <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      The Python API, that is the list of methods available in Python,
      is still experimental and may change!
    </p>
  </div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
    For further information, the web page maintained by Jon Käre
    Hellan's has some python plugins and other useful
    information. That page can be found through <a class="ulink" href="http://domen.uninett.no/~jk/gnumeric/" title="http://domen.uninett.no/~jk/gnumeric/">this link</a>. The
    main <a class="ulink" href="http://www.gnome.org/projects/gnumeric/" title="http://www.gnome.org/projects/gnumeric/">Gnumeric
    page</a> may also have useful information.
  </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
    If you need help online, you may want to check out:

      <div class="list"><div class="itemizedlist"><ul><li>
          <span class="para">
            The Gnumeric Function-Writer's Guide. Until I write one
            for Python, you'll have to settle for
            <span class="literal" style="font-family: monospace; ">doc/developer/writing-functions.sgml</span> in
            the Gnumeric source tree.
          </span>
        </li><li>
          <span class="para">
            The files that actually define the Python interface. In
            particular,
            <span class="literal" style="font-family: monospace; ">plugins/python-loader/py-gnumeric.c</span> has
            good comments at the beginning.
          </span>
        </li><li>
          <span class="para">
            The instructions on how to use GNOME CVS can be found <a class="ulink" href="http://developer.gnome.org/tools/cvs.html" title="http://developer.gnome.org/tools/cvs.html">here</a>.
          </span>
        </li><li>
          <span class="para">
            The gnumeric discussion list:
            <span class="literal" style="font-family: monospace; ">&lt;gnumeric-list@gnome.org&gt;</span>
          </span>
        </li><li>
          <span class="para">
            The IRC channel #gnumeric on the GIMPnet server.  Right
            now, the project leader is Jody Goldberg (jody) and the
            Debianizer is: J.H.M. Dassen (jhm). Jody, Jon K. Hellan,
            and Zbigniew Chyla appear prominently in the Python
            ChangeLog.
          </span>
        </li></ul></div></div>

  </p><div class="sect2"><a name="sect-extending-python-install"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.1. </span>Installing and Building Gnumeric for Python</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      This section describes how to obtain the
      <span class="application" style="font-style: italic; ">Gnumeric</span> source code, configure it
      for Python and build it. This section will eventually be
      removed as Python becomes supported by default.
    </p><div class="sect3"><a name="sect-extending-python-install-prelim"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.1.1. </span>Preliminaries</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      I'm going to define some variables here so that you can insert
      the appropriate command or item for your system when they
      occur. I'll prefix them all with '$'.
    </p><div class="list"><div class="itemizedlist"><ul><li>
        <span class="para">
        <span class="emphasis" style="font-style: italic; ">$root</span>: Do whatever you do to become
        root. The usual options are:

        <div class="list"><div class="itemizedlist"><ul><li>
            <span class="para">
              <span class="literal" style="font-family: monospace; ">su -</span> and hit <span class="keycap" style="font-weight: bold; ">Enter</span>
            </span>
          </li><li>
            <span class="para">
            <span class="literal" style="font-family: monospace; ">sudo</span>
            </span>
          </li><li>
            <span class="para">
            <span class="literal" style="font-family: monospace; ">fakeroot</span> (works in some situations, but
            not all)
            </span>
          </li></ul></div></div>
        </span>
      </li><li>
         <span class="para">
           <span class="emphasis" style="font-style: italic; ">$version</span>: Whatever your current
           Gnumeric version is. Some examples:

           <div class="list"><div class="itemizedlist"><ul><li><span class="para">1.1.20</span></li><li><span class="para">1.1.20-bonobo</span></li><li><span class="para">1.1.90</span></li></ul></div></div>
         </span>
       </li></ul></div></div></div><div class="sect3"><a name="sect-extending-python-install-build"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.1.2. </span>In the Beginning (Installing and Building)</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      You need to get Python and Gnumeric, and the Python plugin for
      Gnumeric. You can get the binaries, the packaged source, or the
      developing edge CVS.
    </p><div class="sect4"><a name="sect-extending-python-install-binaries"/><h4 class="sect4 title"><span class="title"><span class="label">13.3.1.2.1. </span>Getting the binaries (Debian)</span></h4><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        I've only tested this on sid (unstable). The version you get
        from stable (woody) may not act quite the same.
      </p><div class="list"><div class="procedure"><ul><li>
          <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
            <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">apt-get install
            gnumeric gnumeric-python python</span>
          </p>
        </li></ul></div></div></div><div class="sect4"><a name="sect-extending-python-install-debsource"/><h4 class="sect4 title"><span class="title"><span class="label">13.3.1.2.2. </span>
        Getting and building the current Debianized source
      </span></h4><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        If you have Debian, and don't need the bleeding edge, this is
        <span class="emphasis" style="font-style: italic; ">by far</span> the easiest way to get and build
        the source.
      </p><div class="list"><div class="procedure"><ol><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Change to a directory where you want to hang the source
              directory.
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">apt-get build-dep
			  gnumeric</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">apt-get source gnumeric</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">cd gnumeric-</span><span class="emphasis" style="font-style: italic; ">$version</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">debian/rules build</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              To make the .deb packages: <span class="emphasis" style="font-style: italic; ">$root</span>
            <span class="literal" style="font-family: monospace; ">./debian/rules binary</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              To install those .deb packages:
            </p>
            <div class="list"><div class="procedure"><ol><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  <span class="literal" style="font-family: monospace; ">cd ..</span> to change to that directory.
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">dpkg -i
                  gnum*deb</span> (presuming you don't have other
                  .deb packages beginning with "gnum" lying around
                  here.
                </p>
              </li></ol></div></div>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              You may or may not want to remove those .deb files now:
              <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">rm
              gnum*deb</span>)
            </p>
           </li></ol></div></div></div><div class="sect4"><a name="sect-extending-python-install-cvs"/><h4 class="sect4 title"><span class="title"><span class="label">13.3.1.2.3. </span>Getting and building the source from CVS-HEAD</span></h4><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        Remember that this is the developing edge. Things may not
        work. Generally don't do this unless you are subscribed to the
        mail list and possibly also on the IRC channel.
      </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        You will need a few things for this to work at all:
      </p><div class="list"><div class="procedure"><ol><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">gnome-common</p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">libgsf (see below)</p></li><li>
             <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
               pygtk2 (On Debian, make sure to get python-gtk2 and
               python-gtk2-dev)
             </p>
           </li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">gnumeric (see below, obviously)</p></li></ol></div></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        And although the following will build in the main build space,
        it's probably better to build in a temporary space. But I
        can't be bothered to learn how to fiddle the build pathways.
      </p><div class="list"><div class="procedure"><ol><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Change to a directory where you want to hang the source
              directory for Gnumeric and a few other Gnome things.
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">export
              CVSROOT=:pserver:anonymous@anoncvs.gnome.org:/cvs/gnome</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">cvs login</span> (No password -- hit
              RETURN.)
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Getting and building libgsf:
            </p>

            <div class="list"><div class="procedure"><ol><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  cvs co libgsf
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  cd libgsf
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  Red Hat: <span class="literal" style="font-family: monospace; ">./autogen.sh</span>
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  Debian: <span class="literal" style="font-family: monospace; ">./autogen.sh --prefix=/usr
                --with-gconf-schema-file-dir=/etc/gconf/schemas</span>
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  <span class="literal" style="font-family: monospace; ">make</span>
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">make install</span>
                </p>
              </li><li>
                <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
                  If you find that this didn't work, try <span class="literal" style="font-family: monospace; ">make
                  clean</span> and then repeat from the autogen
                  step.
                </p>
              </li></ol></div></div>

          </li><li>
             <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
               Getting and building libgal <span class="emphasis" style="font-weight: bold; ">No longer necessary! (13 June
               2003)</span>
             </p>
	  </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Getting and building gnumeric:
            </p>
		  <div class="list"><div class="procedure"><ol><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">cvs -z3 checkout gnumeric -d
				gnumeric-head</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">cd gnumeric-head</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Red Hat: <span class="literal" style="font-family: monospace; ">./autogen.sh</span> and wait while it
			  compiles</p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Debian: <span class="literal" style="font-family: monospace; ">./autogen.sh --prefix=/usr --with-gconf-schema-file-dir=/etc/gconf/schemas</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">make</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="emphasis" style="font-weight: bold; ">Optional:</span> <span class="emphasis" style="font-style: italic; ">$root</span> <span class="literal" style="font-family: monospace; ">make install</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">If you find that this didn't work, try <span class="literal" style="font-family: monospace; ">make clean</span> and
			  then repeat from the autogen step. For example,
			  sometimes I've had it not create the python-loader.</p></li></ol></div></div>
	   </li></ol></div></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
          OK, you should now have gnumeric! Test it! If you installed
          the Debianized version via apt-get, or did "make install",
          it should be installed to /usr/bin (or /usr/local/bin on
          Red Hat?)  and you can just type
          <span class="literal" style="font-family: monospace; ">gnumeric</span>. Otherwise you will find it in
          <span class="literal" style="font-family: monospace; ">gnumeric-head/src/</span> and you will have to
          run it from there. 
        </p></div></div></div><div class="sect2"><a name="sect-extending-python-console"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.2. </span>The Python Console</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      There is an interactive Python console available from inside
      Gnumeric. This is a good place to explore things, and if the
      console is expanded, will be a nice place for scripting. In the
      meantime, what I have called "Spellbooks" below are much more
      useful, but are fixed plugins as of Gnumeric startup. So right
      now I putter in the console as I develop plugin literal in the
      form of spellbooks. After 1.2.0, Gnumeric will be working on its
      scripting API, so the two approaches may merge. Or not.
    </p><div class="sect3"><a name="sect-extending-python-console-enabling"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.2.1. </span>Enabling the Python Console</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        You can run a Python interpreter from inside Gnumeric, but you
        have to turn it on. To do this you simply uncomment a line in
        python-loader/plugins.xml. Normally, that file lives in
        /usr/lib/gnumeric/<span class="emphasis" style="font-style: italic; ">$version</span>/plugins/python-loader/,
        or perhaps <span class="emphasis" style="font-style: italic; ">/usr/local/lib...</span> on Red Hat.
        I used to suggest making a local but you should probably make
        a local copy, but that was pain for little gain. So:
      </p><div class="list"><div class="procedure"><ol><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">gnumeric --version</span> to make sure you
              get the right version name for the following. (You'll
              have to do this for every new version of Gnumeric!).
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="literal" style="font-family: monospace; ">cd ~/.gnumeric/</span>
                <span class="emphasis" style="font-style: italic; ">$version</span>
                 <span class="literal" style="font-family: monospace; ">/plugins/</span>
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Edit <span class="literal" style="font-family: monospace; ">python-loader/plugin.xml</span>.
            </p>
          </li><li>
           <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
               Uncomment the five lines starting with
               <span class="literal" style="font-family: monospace; ">ui-console-menu service</span> near the
               bottom (remove the "&lt;!--" and "--&gt;" tags around
               the &lt;service...&gt; and &lt;/service&gt; tags.
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Save the file.
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Start gnumeric (same version).
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              Select from the <span class="guimenu" style="font-weight: bold; ">Tools</span> the <span class="guimenuitem" style="font-weight: bold; ">Python
              console</span>.
            </p>
          </li><li>
            <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
              <span class="emphasis" style="font-style: italic; ">Enjoy!</span>
            </p>
          </li></ol></div></div></div><div class="sect3"><a name="sect-extending-python-console-playing"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.2.2. </span>Playing with the Python console</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        At the top there is a drop-down menu <span class="guimenu" style="font-weight: bold; ">Execute
        in</span>. Right now your only choice will be
        <span class="guimenuitem" style="font-weight: bold; ">Default</span>. After you evaluate functions
        from other plugins, those environments will become available
        too (JK says this is called lazy loading). But I'll assume you
        are using Default. (The only real difference is that you have
        to import Gnumeric first, and you can't see your plugin
        functions.)
      </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        (Note: older releases required you to type <span class="literal" style="font-family: monospace; ">print
        dir()</span> instead of just
        <span class="literal" style="font-family: monospace; ">dir()</span>. Fixed in cvs 16 June 2003, and
        certainly in 1.1.20 and higher.
      </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        Let's start by taking a look at the environment.
      </p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">&gt;&gt;&gt; import <span class="co">1</span>Gnumeric
&gt;&gt;&gt; dir()
['Gnumeric', '__builtins__', '__doc__', '__name__']
&gt;&gt;&gt; dir(Gnumeric)
['Boolean', 'CellPos', 'FALSE', 'GnumericError', 'GnumericErrorDIV0',
'GnumericErrorNA', 'GnumericErrorNAME', 'GnumericErrorNULL',
'GnumericErrorNUM', 'GnumericErrorRECALC', 'GnumericErrorREF',
'GnumericErrorVALUE', 'MStyle', 'Range', 'TRUE', '__doc__',
'__name__', <span class="co">2</span>'functions', 'plugin_info', 'workbook_new', 'workbooks'] 

      </pre></div>
      
        <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
          'Gnumeric' is a module that exists only within Gnumeric, and
          which defines the Gnumeric Python API.
        </p>
      

      
        <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
          Gnumeric.functions is the list of all the Gnumeric functions
          you would see in the function browser. You cannot yet do
          <span class="literal" style="font-family: monospace; ">dir(Gnumeric.functions)</span> but maybe someone
          will bind that soon.
        </p>

        <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
          RangeRef is not listed. That seems to limit us, though later
          in the tutorial we'll see how to use regular functions to
          get inside RangeRefs.
        </p>

      
      <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
        So do some exploring. First, let's poke around to figure out
        how to use CellPos.
      </p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting"># I wonder how to use CellPos (I've glanced at the source, but...)

&gt;&gt;&gt; dir(Gnumeric.CellPos)                 # shows nothing useful

&gt;&gt;&gt; Gnumeric.CellPos()                    
TypeError: CellPos() takes exactly 2 arguments (0 given)  

&gt;&gt;&gt; Gnumeric.CellPos("a1","a2") 
TypeError: an integer is required.        # Right. 

&gt;&gt;&gt; a=Gnumeric.CellPos(1,2)               # It worked!
&gt;&gt;&gt; a
&lt;CellPos object at 0x106b6eb8&gt;      # Yeah, I know...

&gt;&gt;&gt; dir(a)
['get_tuple']

&gt;&gt;&gt; a.get_tuple()
(1,2)                                     # Cool. That's (col,row)

&gt;&gt;&gt; str(a)                                # Super cool.
'B3'                                      # JK hasn't implemented this for tuples yet
       </pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
         Similarly, we can explore Gnumeric.Range:
       </p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">&gt;&gt;&gt; r = Gnumeric.Range((1,2),(3,4))
TypeError: Range() argument 1 must be CellPos, not tuple

&gt;&gt;&gt; r = Gnumeric.Range(a,a)
&gt;&gt;&gt; r
&lt;Range object at 0x1071d888&gt;

&gt;&gt;&gt; dir(r)
['get_tuple']

&gt;&gt;&gt; r.get_tuple()
(3, 7, 3, 7)
	  </pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">If you
		evaluate in the context of a plugin (rather than in Default), then
		<span class="literal" style="font-family: monospace; ">dir(Gnumeric.plugin_info)</span> will reveal some simple
		informational functions you can call for the local plugin(s).</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Note: obviously I don't really know what I'm doing, or I wouldn't
		be poking around like this.</p></div><div class="sect3"><a name="sect-extending-python-console-morefun"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.2.3. </span>More fun with the Python console</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Jon K. Hellan writes, "Here are some more things you can do
	  from the console:"</p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting"># Get a workbook
&gt;&gt;&gt; wb=Gnumeric.workbooks()[0]
&gt;&gt;&gt; wb
&lt;Workbook object at 0x862a490&gt;
&gt;&gt;&gt; dir(wb)
&gt;&gt;&gt; ['gui_add', 'sheet_add', 'sheets']

# Get a sheet
&gt;&gt;&gt; s=wb.sheets()[0]
&gt;&gt;&gt; s
&lt;Sheet object at 0x863e8d0&gt;
&gt;&gt;&gt; dir(s)
['cell_fetch', 'get_extent', 'get_name_unquoted', 'rename',
'style_apply_range', 'style_get', 'style_set_pos', 'style_set_range']

# Get a cell. s.cell_fetch(0,0) and s[0,0] are synonyms. First
# coordinate is columns, i.e. s[1,0] is B1.
&gt;&gt;&gt; c=s[0,0]
&gt;&gt;&gt; c
&lt;Cell object at 0x863d810&gt;
&gt;&gt;&gt; dir(c)
['get_entered_text', 'get_mstyle', 'get_rendered_text', 'get_value',
'get_value_as_string', 'set_text']

# Change the cell - it changes in the grid
&gt;&gt;&gt; c.set_text('foo')

# Retrieve the cell - both ways.
&gt;&gt;&gt; c.get_value()
foo
&gt;&gt;&gt; s.cell_fetch(0,0).get_value()
foo
</pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Very, very nice.  Note, after setting a value, it won't show up
		until that cell is redrawn. That will happen automatically with plugin
		functions, but in the console, you may have to click on the cell.
	  </p></div></div><div class="sect2"><a name="sect-extending-python-builtins"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.3. </span>Using the built-in Python functions</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
      To enable the Python-loader and Python plugins:
    </p><div class="list"><div class="procedure"><ol><li>
         <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
           Select the <span class="guimenu" style="font-weight: bold; ">Tools</span> menu and the
           <span class="guimenuitem" style="font-weight: bold; ">Plugins</span> menuitem.
         </p>
       </li><li>
         <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
           Select "Python plugin loader" and "Python
           functions". Restart Gnumeric.
         </p>
       </li></ol></div></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">The quickest way to test whether you now have Python functions
	  is to type <span class="literal" style="font-family: monospace; ">=py_capwords("fred flintstone")</span> in the
	  first cell. After you hit &lt;Enter&gt;, you should see "Fred
	  Flintstone".</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">You can also click on the functions button, and scroll down to
	  the "Python" category. Select that. You should see at
	  least two functions defined: PY_CAPWORDS and PY_PRINTF. They're
	  not very useful, but they prove you've got the plugins. Test
	  them either via the GUI or by typing into the cell.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">I'll presume they worked.</p></div><div class="sect2"><a name="sect-extending-python-writing"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.4. </span>Writing your own Python functions</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">To scribe new magic you must write your spells in places where
	  Gnumeric will find them. That place is in folders under:
	  <span class="literal" style="font-family: monospace; ">~/.gnumeric/&lt;version&gt;/plugins/</span>
	  Each folder under here is one "spellbook" of new plugin
	  functions. You may put all your spells in one spellbook, or group
	  them neatly depending on your tastes. Each spellbook must have two
	  files. We'll create a spellbook called "myfuncs". A pedestrian name
	  for pedestrian spells. When I have more skill, perhaps I'll make
	  some with better names. Several suggest themselves:
	  <div class="list"><div class="itemizedlist"><ul><li><span class="para">Transformations: of obvious value for a spreadsheet</span></li><li><span class="para">Illusions: statistical functions, clearly</span></li><li><span class="para">Charms: presentation graphics</span></li><li><span class="para">Necromancy: file repair and missing values?</span></li><li><span class="para">Divination: data mining!</span></li></ul></div></div>
	</p><div class="sect3"><a name="sect-extending-python-writing-prepare"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.4.1. </span>Prepare the spellbook</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">In many ways it would be easier to start by copying the
	  py_func spellbook to your local .gnumeric folder, and just adding a
	  function to that. But in general it will be more useful to be
	  able to write your own separate spellbooks, so here we go.</p><div class="list"><div class="procedure"><ol><li>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			<span class="emphasis" style="font-weight: bold; ">Make the folder: </span>
			First we make the folders and get into the right one. As noted
			above, we'll call our folder (spellbook) myfuncs.
		  </p>
		  <div class="substeps"><ol type="a">
			<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">If they don't already exist:</p>
			  <div class="substeps"><ol type="i">
				<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">mkdir ~/.gnumeric</span></p></li>
				<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">mkdir ~/.gnumeric/&lt;version&gt;</span></p></li>
			  </ol></div>
			</li>
			<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">mkdir ~/.gnumeric/&lt;version&gt;/myfuncs/</span></p></li>
			<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">cd ~/.gnumeric/&lt;version&gt;/myfuncs/</span></p></li>
		  </ol></div>
		</li><li>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			<span class="emphasis" style="font-weight: bold; ">Make the files:</span>
			A spellbook has two files. The first is the python file
			with the functions. The second is the XML file "plugin.xml". The
			XML file holds that master spells that tell Gnumeric what
			functions we've defined, and what the name of the python file
			<span class="emphasis" style="font-style: italic; ">is</span>, and one other important item. We'll create these as
			blank files.
		  </p>
		  <div class="substeps"><ol type="a">
			<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">touch my-func.py</span></p></li>
			<li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para"><span class="literal" style="font-family: monospace; ">touch plugin.xml</span></p></li>
		  </ol></div>
		</li><li>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			<span class="emphasis" style="font-weight: bold; ">Write the master spells</span>
			The good news is that you only need to do this once per
			spellbook. After that you just add spells to it.
		  </p>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Your XML file must tell Gnumeric about your plugin. Here is a
			simple template. (If you want to learn about internationalization,
			see the example in the system's py-func spellbook.) Open up
			plugin.xml and insert the following lines:
		  </p>

		  <div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;plugin id="Gnumeric_MyFuncPlugin"&gt;
	&lt;information&gt;
		&lt;name&gt;Other Python functions from HOWTO&lt;/name&gt;
		&lt;description&gt;A few extra python functions demonstrating the API.&lt;/description&gt;
	&lt;/information&gt;
	&lt;loader type="Gnumeric_PythonLoader:python"&gt;
		&lt;attribute name="module_name" value="<span class="emphasis" style="font-weight: bold; ">my-func</span>"/&gt; <span class="co">3</span>
	&lt;/loader&gt;
	&lt;services&gt;
		&lt;service type="function_group" id="<span class="emphasis" style="font-weight: bold; ">example</span>"&gt; <span class="co">4</span>
			&lt;category&gt;Local Python&lt;/category&gt;
			&lt;functions&gt;
			&lt;/functions&gt;
		&lt;/service&gt;
	&lt;/services&gt;
&lt;/plugin&gt;
		  </pre></div>

                  
		  
			<p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			  The value of "name" determines the name of your python
			  script (file). In this case, it must be "my-func.py"
			</p>
		  

		  
			<p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			  The value of "id" here determines the name of the
			  function dictionary in your python script. In this case,
			  it must be "example_functions" because here the value is
			  "example".
			</p>
		  
                  
		</li><li>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
			<span class="emphasis" style="font-weight: bold; ">Prepare to write the
			spells:</span> Next we'll create a minimal python
			file. As noted above, we must name the file
			<span class="emphasis" style="font-weight: bold; ">my-func</span>.py and it must have a dictionary
			called <span class="emphasis" style="font-weight: bold; ">example</span>_functions.
			So open up my-func.py and insert the following lines.
		  </p>
		  <div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting"># my-func.py
#

from Gnumeric import GnumericError GnumericErrorVALUE
import Gnumeric
import string
	
example_functions = {
}
		  </pre></div>
		</li></ol></div></div></div><div class="sect3"><a name="sect-extending-python-writing-newspells"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.4.2. </span>Writing new spells</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">To add new functions to Python, you now must do five things
		(three sir!):</p><div class="list"><div class="procedure"><ol><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Write the python function in your copy of
		  <span class="literal" style="font-family: monospace; ">my-func.py</span>.</p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Insert the function info into the <span class="literal" style="font-family: monospace; ">example_functions</span>
		  dictionary at the end of <span class="literal" style="font-family: monospace; ">my_func.py</span></p></li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Insert the function name into the functions list at the end of
		  <span class="literal" style="font-family: monospace; ">plugin.xml</span>.</p></li></ol></div></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
		<span class="emphasis" style="font-weight: bold; ">Writing a simple script:</span>
		Let's do something very simple: add two numbers
		together. First, edit my-func.py.</p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">	<span class="emphasis" style="font-style: italic; "># Add two numbers together</span>
    def func_add(num1, num2):
        return num1 + num2

    <span class="emphasis" style="font-style: italic; "># Translate the func_add python function to a gnumeric function and register it</span>
    example_functions = {
        'py_add': func_add
    }
	  </pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Then let the plugin-loader(?) know about your function. Add the
	following line near the end of plugin.xml (between
	  &lt;functions&gt; and &lt;/functions&gt;).</p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">                 &lt;function name="py_add"/&gt;
	</pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Now start Gnumeric and type <span class="literal" style="font-family: monospace; ">py_add(2,3)</span> into a
	  cell. You should get "5". You can also use cell references. If
	  that was in cell A1, go to cell A2 and type
	  <span class="literal" style="font-family: monospace; ">py_add(A1,3)</span> and you will get "8".  But your
	  function won't show up in the GUI list yet.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
		<span class="emphasis" style="font-weight: bold; ">Tell the GUI:</span>
		To make your function show up in the GUI, you have to tell
		Gnumeric some things about it via a standard header, like
		this:</p><div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">	<span class="emphasis" style="font-style: italic; "># Add two numbers together</span>
	def func_add(num1, num2):
        '@FUNCTION=PY_ADD\n'\
        '@SYNTAX=py_add(num1, num2)\n'\
        '@DESCRIPTION=Adds two numbers together.\n'\
        'Look, the description can go onto other lines.\n\n'\
        '@EXAMPLES=To add two constants, just type them in: py_add(2,3)\n'\
        'To add two cells, use the cell addresses: py_add(A1,A2)\n\n'\
        '@SEEALSO='

        return num1 + num2
	  </pre></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">The text after '@DESCRIPTION=' is the description that shows up
		in the function GUI. You can make it as simple or detailed as you
		want. I'm not sure how many other fields get used right now, as I
		haven't seen the EXAMPLES show up anywhere.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">But this still isn't quite right. Gnumeric doesn't know how
		many arguments the function can handle, nor of what type. So the
		function GUI will prompt for the two values it knows about (as
		type "Any") and then keep prompting for more. But py_add cannot
		accept all types, nor can it handle more than two arguments, so
		unless you give it precisely 2 numbers, you will get an error when
		you click "OK".</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
		<span class="emphasis" style="font-weight: bold; ">Know your limits...</span>
		We got away last time just because Gnumeric was forgiving. Now
		we need to say that we can accept only 2 values, of type
		floating-point (which will also handle ints).</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Where before we had: <span class="literal" style="font-family: monospace; ">'py_add': func_add</span>, 
		we should now put: <span class="literal" style="font-family: monospace; ">'py_add': ('ff','num1,num2',func_add)</span>
		This says that Gnumeric should expect two floating-point numbers
		('ff') with names 'num1' and 'num2', and pass them to func_add.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">
		<span class="emphasis" style="font-weight: bold; ">...and surpass them</span>
		Of course, there is no reason an add function shouldn't be able
		to handle a range. The simplest way to do that is to accept a
		range, and then call Gnumeric's own SUM function on it! All of
		Gnumeric's functions are available to you in the dictionary
		Gnumeric.functions, keyed by name. So here is how to write py_sum.
	  </p><div class="list"><div class="procedure"><ol><li>
		  <p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">First, define func_sum (in my-func.py):</p>
		  
		  <div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">def func_sum(gRange):
	'@FUNCTION=PY_SUM\n'\
	'@SYNTAX=PY_SUM(range)\n'\
	'@DESCRIPTION=Adds a range of numbers together.'\
	'Just like built-in SUM.\n\n'\
	'@EXAMPLES=To add values in A1 to A5, just type them in:\n'\
	'    py_sum(a1:a5)\n'\
	'@SEEALSO='
	try:
		sum = Gnumeric.functions['sum']
		val = sum(gRange)
		#  val = reduce(lambda a,b: a+b, vals)
	except TypeError:
		raise GnumericError, GnumericErrorVALUE
	else:
		return val
		  </pre></div>
		</li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Then insert it into your functions dictionary. That
		dictionary now looks like this (with 'r' denoting a range type):</p>

		  <div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">example_functions = {
	'py_add': ('ff','num1,num2',func_add),
	'py_sum': ('r', 'values', func_sum)
}
		  </pre></div>
		</li><li><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Finally, make an entry in the XML list, so that it now looks
		  like:</p>
		  <div xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="programlisting block-indent"><pre class="programlisting">			&lt;functions&gt;
				&lt;function name="py_add"/&gt;
				&lt;function name="py_sum"/&gt;
			&lt;/functions&gt;
		  </pre></div>
		</li></ol></div></div><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">I told you this was the easy way to do it. Obviously it's not
		very useful to just duplicate Gnumeric functions. But that's as
		far as I've made it. From what can tell, range objects are
		packaged as opaque pointers of type RangeRefObject. There seems
		to be no way to work with them from within Python, so we must
		rely on the Gnumeric functions.</p></div><div class="sect3"><a name="sect-extending-python-writing-newspells2"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.4.3. </span>Do it yourself (mostly)</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">All is not lost, despite the opaque pointers. For in Gnumeric
    we can read about all the functions that have been defined. Some
    of those take references (including RangeRefs) and return useful
    information. For example, under "Lookup" we find "Column" and
    "Row" which return arrays of all the column (or row) indices in
    the range. So we can redo the sum function.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Presume we can convert our RangeRef to a start tuple and and
    end tuple. Then we can write sum2:
		<div class="programlisting block-indent"><pre class="programlisting">def func_sum2(gRange):
	'@FUNCTION=PY_SUM2\n'\
	'@SYNTAX=PY_SUM2(range)\n'\
	'@DESCRIPTION=Adds a range of numbers together,'\
	'without calling built-in SUM.\n\n'\
	'@EXAMPLES=To add values in A1 to A5, just type them in:\n'\
	'    py_sum(a1:a5)\n'\
	'@SEEALSO='
	try:
		[r_begin, r_end] = range_ref_to_tuples(gRange)
		wb=Gnumeric.Workbooks()[0]   # Careful! This is WRONG! It doesn't
		s=wb.sheets()[0]             # use the ACTUAL workbook or sheet.

		val = 0
		for col in range(r_begin[0], r_end[0]):
			for row in range(r_begin[1], r_end[1]):
				cell = s[col, row]
				val = val + cell.get_value()
				# Note: this doesn't skip blank cells etc.

	except TypeError:
		raise GnumericError,GnumericErrorVALUE
	else:
		return val
		</pre></div>
	  </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">That's fine as far as it goes, but we need to define the helper
    function "range_ref_to_tuples". Although I'm rather ashamed to
    show this ugly literal, here's how I did it (someone suggest a
    better way, please!):
		<div class="programlisting block-indent"><pre class="programlisting">def range_ref_to_tuples(range_ref):
	'''I need a function to find the bounds of a RangeRef. This one
	extracts them from the Gnumeric "column" and "row" commands, and
	returns them as a pair of tuples. Surely there is a better way?
	For example, return a list of cells??'''

	col  = Gnumeric.functions['column']   
	row  = Gnumeric.functions['row']

	# "column" and "row" take references and return an array of col or row
	# nums for each cell in the reference. For example, [[1, 1, 1], [2, 2, 2]]
	# for columns and [[2, 3, 4], [2, 3, 4]] for rows.

	try:
		columns = col(range_ref)
		rows    = row(range_ref)

		begin_col = columns[0][0] - 1  
		begin_row = rows[0][0] - 1     

		end_col = columns[-1][-1]
		end_row = rows[-1][-1]

		# We subtracted 1 from the begin values because in the API,
		# indexing begins at 0, while "column" and "row" begin at 1.
		# We did NOT subtract 1 from the end values, in order to make
		# them suitable for Python's range(begin, end) paradigm.
		
	except TypeError:
		raise GnumericError,GnumericErrorVALUE
	except NameError:                     # right name?
		raise GnumericError,Gnumeric.GnumericErrorNAME
	except RefError:                     # right name?
		raise GnumericError,Gnumeric.GnumericErrorREF
	except NumError:                     # right name?
		raise GnumericError,Gnumeric.GnumericErrorNUM


	return [ (begin_col, begin_row), (end_col, end_row) ]
		</pre></div>
	  </p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">From there, insert the function into the dictionary, and insert
		its name into <span class="literal" style="font-family: monospace; ">plugin.xml</span>. I leave these as exercises
		to the reader (answers in the sample files -- no
		peeking!). Restart Gnumeric and you should be able to use
		py_sum2!</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">There are a couple of glitches:</p><div class="list"><div class="itemizedlist"><ul><li><span class="para">It fails the first time with "could not import
		  gobject". Just run again, I don't know what that's about.</span></li><li><span class="para">It will only work for Workbook 1 and Sheet 1. JK thinks that
		  there may be no way to get the current Workbook/Sheet in the
		  Python API. Hrm....</span></li><li><span class="para">As noted, it should do some simple trapping to skip blank or
      text-filled cells. That <span class="emphasis" style="font-style: italic; ">can</span> be done! I just didn't. It's
      late.</span></li></ul></div></div></div><div class="sect3"><a name="extending-python-writing-help"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.4.4. </span>More help</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Relative to the source tree:</p><div class="list"><div class="itemizedlist"><ul><li><span class="para">The Python interface is defined in: <span class="literal" style="font-family: monospace; ">plugins/python-loader/py-gnumeric.c</span>
		  That file also has good notes at the beginning.</span></li><li><span class="para">There are interesting things about the way it used to be in:
		  <span class="literal" style="font-family: monospace; ">doc/developer/python-gnumeric.txt</span>.</span></li></ul></div></div></div><div class="sect3"><a name="extending-python-writing-programs"/><h3 class="sect3 title"><span class="title"><span class="label">13.3.4.5. </span>Program Listings</span></h3><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">You can see my examples in full, with more comments:
		<div class="list"><div class="itemizedlist"><ul><li><span class="para"><a class="ulink" href="myfuncs/my-func.py" title="myfuncs/my-func.py"><span class="literal" style="font-family: monospace; ">my-func.py</span></a></span></li><li><span class="para"><a class="ulink" href="myfuncs/plugin.xml" title="myfuncs/plugin.xml"><span class="literal" style="font-family: monospace; ">plugin.xml</span></a></span></li></ul></div></div>
	  </p></div></div><div class="sect2"><a name="extending-python-upgrading"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.5. </span>Upgrading</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">To upgrade, first choose any method from the installation
	section above. But note: when you upgrade your Gnumeric version,
	it will look for your Python scripts in the corresponding
	version-named subdirectories. For example, if your scripts are in
	"~/.gnumeric/1.1.17/plugins", but you just upgraded to 1.1.18, you
	may need to rename that to "~/.gnumeric/1.1.18/plugins". If you
	want to keep and run several versions of Gnumeric, you'll have to
	copy or symlink them.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">If you want the Python console, you'll also have to
	re-enable it, following the directions above. If you had made a
	local copy of the old one, make sure you
	<span class="emphasis" style="font-style: italic; ">don't</span> copy or link that to the new
	directory. It won't work.</p><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">Find the new version with <span class="literal" style="font-family: monospace; ">gnumeric --version</span>,
	  making sure to invoke the proper gnumeric.</p></div><div class="sect2"><a name="sect-extending-python-fancy"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.6. </span>Fancy tricks</span></h2><p xmlns:msg="http://www.gnome.org/~shaunm/gnome-doc-utils/l10n" class="para">To be written....</p><div class="list"><div class="itemizedlist"><ul><li><span class="para">Swapping ranges (not a normal cell function, but I wrote
      one) that did this. But now I can rewrite it using the GUI,
		which will make a lot more sense.</span></li><li><span class="para">JK's python-only transpose function</span></li><li><span class="para">A Gnumeric interface to the Snob clustering
		algorithm. Coming soon to a spreadsheet near you!</span></li></ul></div></div></div><div class="sect2"><a name="sect-extending-python-questions"/><h2 class="sect2 title"><span class="title"><span class="label">13.3.7. </span>Features wanted, and Questions</span></h2><div class="list"><div class="itemizedlist"><ul><li><span class="para">Is it really impossible to determine the current
      workbook/sheet from Python? That's a bummer.  [JK writes: "Not
      yet fixed, but now fixable."]</span></li><li><span class="para">Several previous items are no longer on this list, due to
      the diligence of the Gnumeric hackers.</span></li></ul></div></div></div></div></div><div class="navbar"><div class="navbar-prev"><span class="navbar-prev"><a class="navbar navbar-prev" href="sect-extending-functions.shtml" title="Defining New Functions">Defining New Functions</a></span></div><div class="navbar-next"><span class="navbar-next"><a class="navbar navbar-next" href="sect-extending-plugins.shtml" title="Writing New Plugins">Writing New Plugins</a></span></div></div></body></html>
