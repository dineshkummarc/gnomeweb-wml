2006-05-08  Jody Goldberg <jody@gnome.org>

	* Release 1.7.0

2006-05-07  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Ensure pkg-config is recent enough to support private
	libraries. 
	* libspreadsheet-1.7.pc.in: libart-2.0 is not being exposed by
	libspreadsheet's headers; mark it as private.

2006-05-06  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_autofill_redo): Fit columns.

2006-05-06  Jody Goldberg <jody@gnome.org>

	* libspreadsheet-1.7.pc.in : new.
	* configure.in : Add it.
	* src/Makefile.am : install headers.  When we move to subversion we
	  can move the path around a bit, with cvs too much surgery would be
	  required.

2006-05-05  Jody Goldberg <jody@gnome.org>

	* src/dependent.h : s/DependentClass/GnmDependentClass/ to be
	  consistent.

2006-05-04  Morten Welinder  <terra@gnome.org>

	* src/item-cursor.c (item_cursor_selection_event): Add help
	messages explaining what is going on.
	(cb_autofill_scroll): Fix hint for inverse autofill.

2006-05-03  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_autofill_redo): Improve selection.

	* src/sheet-autofill.c (sheet_autofill_hint): New function.
	(sheet_autofill_internal): Split out from sheet_autofill.
	(afm_teach_cell): Deduce dateconv here instead of as an init
	paramter.
	(afa_teach_cell): Deduce dateconv here.
	(afa_set_cell): Set format correctly.

	* src/item-cursor.c (cb_autofill_scroll): Display autofill hint.
	(item_cursor_selection_event): Store button state.
	(item_cursor_autofill_event): Use CONTROL state as-of when we
	started the drag, not when we ended it.

	* src/cell-draw.c (cell_finish_layout): Add parameter to allow
	inhibiting numerical overflow.  All callers changed.

2006-05-02  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (cb_max_cell_width, cb_max_cell_height): Call
	cell_finish_layout.  Fixes #67351.

	* src/cell-draw.c (cell_finish_layout): Split out...
	* src/print-cell.c (print_cell): ...here.

	* src/rendered-value.c (rendered_value_new): Wrap texts only.

	* src/main-application.c (main): Gracefully handle missing
	AttachConsole.  #332975.  Modeled after patch by Harun Vos.

	* src/workbook.c (workbook_dispose): Remove debug code that no
	longer does anything but cause criticals.

2006-04-30  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : remove unused code associated with bonobo.  People
	  can pull it from cvs archives if desired.
		: bonobo-io.c
		: bonobo-io.h
		: sheet-object-bonobo.c
		: sheet-object-bonobo.h
		: sheet-object-container.c
		: sheet-object-container.h
		: sheet-object-item.c
		: sheet-object-item.h

2006-05-01  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Always call the display logic for
	the cells as that can change the layouts.  (And do it right while
	we're at it.)

	* src/rendered-value.c (rendered_value_new): Expand
	rendered_value_render and setup the layout fully before rendering.
	Fix latent allocation problem.  Fix border case of filling strings
	that have number formats.

2006-04-29  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: Put a decent status bar message for full
	screen mode.

2006-04-30  Jody Goldberg <jody@gnome.org>

	* src/mstyle.c (gnm_style_is_complete) : implement.

	* src/sheet-style.c (sheet_style_get) : returns a const to make it
	  clear not to touch the result.
	* src/workbook-view.c (wb_view_format_feedback) : update.
	* src/workbook-edit.c (wbcg_edit_finish) : update.

	* src/cell.c (cell_dup) : renamed from cell_copy to be more consistent
	  about naming, and mark as deprecated.

2006-04-29  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_get_index_in_wb) : new for xlsx export.

	* src/selection.h (sv_selection_foreach) : renamed from
	  selection_foreach_range.  All callers changed.
	* src/selection.c (sv_selection_add_full) : renamed from
	  sv_selection_add_range to be clearer.
	(sv_selection_add_range) : new utility that takes a ... GnmRange.

	* src/sheet-view.h : SheetView::selections make this a GSList, no need
	  for a GList.  This makes the api more homogeneous.

	* src/cell.c (cell_get_style) : constify the result and rename from
	  cell_get_mstyle.

	* src/ranges.c (range_as_string) : renamed from range_name.  All
	  callers fixed.

	* src/style-conditions.c (gnm_style_conditions_eval) : tack on hooks
	  for some of the new condition types in office 12.

2006-04-27  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_clone_sheet): Remove.

	* src/wbcg-actions.c (cb_edit_duplicate_sheet): Remove.

	* src/workbook-control-gui.c (wbcg_clone_sheet): New function,
	based on cmd_reorganize_sheets.
	(sheet_action_clone_sheet): Just call wbcg_clone_sheet.

	* src/workbook-edit.c (wbcg_edit_start): Issue a warning if the
	cell has text format, but contains anything but a string.

	* src/wbc-gtk.c (wbc_gtk_init_zoom): Add stock_id.  Not a perfect
	match, but close enough.

2006-04-26  Morten Welinder  <terra@gnome.org>

	* src/style.c (gnm_font_metrics_new, gnm_font_metrics_free,
	gnm_font_metrics_unit): New font metrics setup.

	* src/sheet.c (sheet_col_get_distance_pixels): New function.

	* src/cell.c (cell_get_render_color, cell_get_entered_text,
	cell_rendered_height, cell_rendered_width, cell_rendered_offset):
	Moved from src/rendered-value.c.

	* src/gnm-format.c (gnm_format_layout, gnm_format_general): New
	functions.
	(format_value_gstring): Use gnm_format_general.

	* src/rendered-value.c (rendered_value_render): Calculate column
	widths in pixels and use gnm_format_layout to get accurate
	rendering.  Take layout instead of string.
	(rendered_value_new): Set attributes before the call to
	rendered_value_render.

	* src/hlink.c (gnm_hlink_cur_wb_activate): Prevent a critical.
	#339793.

2006-04-25  Morten Welinder  <terra@gnome.org>

	* src/mstyle.c (gnm_style_get_font): Don't ref the font.  All
	callers changed.

2006-04-24  Morten Welinder  <terra@gnome.org>

	* */*.c: Avoid lots of includes of <gnm-format.h>

2006-04-23  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_reorganize_sheets): Rename from
	cmd_reorganize_sheets2.  Take extra argument optionally specifying
	the front sheet before the action.
	(cmd_reorganize_sheets_undo, cmd_reorganize_sheets_redo): Raise
	relevant sheet.  Fixes #154705.

2006-04-21  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_options_guess): If we guessed a space
	separator that implies we want initial separators ignored.
	Further, space implies tab.
	(stf_parse_options_csv_set_trim_seps): New function.
	(stf_parse_csv_line): Ignore initial separators if asked to.
	Fixes #339297.

2006-04-20  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_options_guess): When we guess a space
	as separators, make two count as one.  Fixes #332997.

	* src/wbc-gtk.c (wbc_gtk_init_zoom, wbc_gtk_init_font_size,
	wbc_gtk_init_font_name): Add tooltip.  Together with goffice patch,
	this fixes #339122.

2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_paste_copy_impl, cmd_autofill_undo,
	cmd_copyrel_undo, cmd_text_to_columns_impl, cmd_paste_cut_redo,
	cmd_paste_cut_undo): Simplify using select_range.
	(cmd_set_text_undo, cmd_set_text_redo): Call select_range.
	(cmd_clear_undo): Simplify using select_selection.
	(cmd_clear_redo, cmd_format_redo, cmd_format_undo): Call
	select_selection.
	(select_range, select_selection): New functions.

2005-04-19  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gui-clipboard.c (image_write): sheet_object_write_image takes an
	extra parameter for export resolution.
	* src/sheet-control-gui.c (scg_drag_send_image): ditto.
	* src/sheet-object-image.c (gnm_soi_write_image): ditto.
	* src/sheet-object-impl.h: ditto.
	* src/sheet-object.c (sheet_object_write_image): ditto.
	* src/sheet-object-graph.c (gnm_sog_write_image): ditto.
	(sog_cb_save_as): ditto. Get resolution from gui_get_image_save_info.
	
2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_apply_style): Don't re-fit heights here.
	Don't redraw twice.
	(sheet_apply_border): Don't redraw twice.
	(cb_max_cell_height): Drop cheap hack that didn't work on
	multi-line text.

	* src/commands.c (cmd_format_undo): Undo in reverse order of redo.
	(cmd_format_redo): Use colrow_autofit.

2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_set_text_redo): Autofit row heights for
	string constants.

	* src/sheet.c (sheet_col_size_fit_pixels): Add extra argument to
	control whether to ignore strings.  All callers changed.
	(sheet_row_size_fit_pixels): Similarly.

2006-04-18  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_set_text_redo): Autofit column based on
	cell's width.

	* src/sheet.c (sheet_col_size_fit_pixels): Take two extra
	arguments specifying the row interval to look at.  All callers
	changed.
	(sheet_row_size_fit_pixels): Similarly.

	* src/colrow.c (colrow_autofit): New primitive to autofit columns
	or rows based on the size of a range.
	(rows_height_update): This is now a special case of
	colrow_autofit.

2006-04-18  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_save_as, wb_view_save,
	wb_view_sendto): Hold a ref to the workbook while the save is in
	progress.  Makes #338847 go away, even if the underlying cause has
	not been fixed.

	* src/wbc-gtk.c (cb_regenerate_window_menu): Safely handle a
	control that no longer has a view (and thus a workbook).

	* src/workbook-control.c (wb_control_get_workbook): Handle NULL
	view.
	* src/workbook-control-gui.c (wbcg_view_changed): Simplify after
	above change.

2006-04-16  Jody Goldberg <jody@gnome.org>

	* gnumeric.desktop.in : Add mimetype for MS Office 12.
	* po/POTFILES.in : add xlsx-read.c

2006-04-16  Jon K Hellan  <hellan@acm.org>

	* src/stf-export.c: Include locale.h to make it build again.

2006-04-15  Morten Welinder  <terra@gnome.org>

	* src/workbook-control.c (workbook_control_class_init): Add a
	"view" property.

	* src/workbook-view.c (wb_view_attach_control,
	wb_view_detach_control): Use g_object_set instead of poking
	directly into wbc->wb_view.  That's cleaner and will fire the
	notify signals.

	* src/workbook-control-gui.c (wbcg_view_changed): Install and
	disconnect workbook signals here.  Watch changes to "view" (which
	implies changes to underlying workbook) and reconnect signals.
	(wbcg_create): Call wbcg_view_changed to update title and watch
	for changes.

	* src/stf-export.c (gnm_stf_export_class_init): New "locale"
	property.
	(stf_export): Switch locale during actual export.

2006-04-15  Jody Goldberg <jody@gnome.org>

	* plugins/fn-info/functions.c : Add HALIGN_DISTRIBUTED and resync a
	  few cases.
	* plugins/html/latex.c (latex2e_write_multicolumn_cell) : ditto.
	* plugins/html/roff.c (roff_file_save) : ditto.
	* plugins/plan-perfect/pln.c (pln_get_style) : ditto.
	* src/cellspan.c (cell_calc_span) : ditto.
	* src/rendered-value.c (rendered_value_new) : ditto.
	* src/dialogs/cell-format.glade : ditto.
	* src/dialogs/dialog-cell-format.c : ditto.
	* plugins/html/html.c (write_cell) : add HALIGN_DISTRIBUTED and fix
	  VALIGN_DISTRIBUTED.
	* src/cell-draw.c (cell_calc_layout) : ditto.
	* src/item-edit.c (get_top_left) : ditto.

2006-04-13  Morten Welinder  <terra@gnome.org>

	* src/gnm-style-impl.h (GnmStyle): Rename content_locked to
	contents_locked and content_hidden to contents_hidden.  All users
	changed.

	* src/clipboard.h (GnmCellRegion): Rename content to contents and
	not_as_content to not_as_contents.  All users changed.

	* src/mstyle.c (gnm_style_get_contents_locked,
	gnm_style_get_contents_hidden, gnm_style_set_contents_locked,
	gnm_style_set_contents_hidden): Renamed from _content_.
	All callers changed.

	* src/clipboard.c (cellregion_cmd_size): New function.

	* src/commands.c (cmd_sort_undo): Do this by pasting old contents.
	Fixes #161890.

	* src/sheet-autofill.c (sheet_autofill_dir): Add support for
	quarters.  Fixes #61650.
	(auto_filler_list): Number is fixed-width.

2006-04-12  Morten Welinder  <terra@gnome.org>

	* src/expr.c (bin_arith): Don't look closely if the result is an
	int because it no longer matters.

	* src/number-match.c (format_match_decimal_number): Fix FMR.
	(format_match_simple): Don't do the integer dance.  (And don't do
	it with two left feet either.)

2006-04-11  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match): When we currently have a date
	format, don't try to match a time.  This has the effect of not
	having "2005" interpreted as about 8 O'clock.
	(format_match_datetime): Handle 2005/5 and 5/2005 too.

2006-04-07  Morten Welinder  <terra@gnome.org>

	* src/test-harness.c (main): Don't use value_get_as_int.

	* src/workbook-edit.c (wbcg_edit_start): Standardize formats for
	time and date entry too.

	* src/rendered-value.c (rendered_value_render): Do not convert to
	unicode minus if the format is date.

	* src/expr-name.c (expr_name_set_expr): Queue deps for recalc.
	Fixes rest of #312610.

	* src/workbook-edit.c (wbcg_edit_start): Reformat numbers as
	general for editing so we don't hide decimals.  Kill extra spaces
	for fraction formats.  Improve cursor positioning for percentages.

	* src/commands.c (cmd_remove_name): New function.

2006-04-06  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_image_create) : dragging in a new image
	  should not resize existing objects being edited, drag back to
	  sheet_mode before creation.

2006-04-06  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (gnumeric_keyed_dialog): Guess alternative button
	order.

2006-04-06  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=314866
	* src/sheet-control-gui.c (scg_drag_receive_same_process) : store the
	  current position as the original before we commit.
	* src/gnumeric-pane.c (cb_pane_drag_end) : restore the ctrl points to
	  the 'original' position in case the drag was canceled.  Hence the
	  magic in scg_drag_receive_same_process.
	  (cb_pane_drag_leave) : 

2006-04-05  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_render): Resolve formats
	the same way as cell_get_format.

2006-04-05  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c : Use shift/ctrl space for select col/row/all
	  even though this is just for show.  The accels are handled
	  in gnumeric-canvas.
	* src/gnumeric-canvas.c (gnm_canvas_key_press) : re-organize to
	  clarify when to handle things.
	(gnm_canvas_colrow_key_press) : new.

2006-04-05  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_help_docs) : Use 'yelp help:gnumeric'
	* gnumeric.desktop.in (DocPath) : add an entry so that things show up
	  in yelp (at least for suse 10.1)

2006-04-01  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=336212
	* src/func.c (function_iterate_argument_values) : This is ugly but it
	  seems to do the right thing.  We can not just assume that args to
	  vararg functions should be evaluated as non-scalars.  It is more
	  subtle.  Simple range_refs (direct or via a name) are non-scalar,
	  but general expressions that use a range (A1:A10=3) evaluate
	  depending on the top level mode, and honor implicit
	  intersecion/iteration.

	* src/position.h : Replace the cols/rows elemnts of GnmEvalPos with a
	  GnmExprArrayCorner pointer.  This allows us to differentiate normal
	  evaluation and singleton arrays.  As a side benefit it uses less
	  memory no 32bit architecture which is important as long as we still
	  use recusion for the recalc queue.

	* src/position.c (eval_pos_init) : adjust to GnmEvalPos change.
	(eval_pos_init_pos) : ditto.
	(eval_pos_init_dep) : ditto.
	(eval_pos_init_cell) : ditto.
	(eval_pos_init_sheet) : ditto.
	* src/expr.c (gnm_expr_eval) : ditto.
	* src/func-builtin.c (gnumeric_table_link) : ditto.
	(gnumeric_table) : ditto.
	* src/dependent.c (link_expr_dep) : ditto.
	* plugins/fn-lookup/functions.c (gnumeric_row) : ditto.
	(gnumeric_col) : ditto.

2006-04-01  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-write.c : Add include to suppress warning.

2006-04-05  Morten Welinder  <terra@gnome.org>

	* src/search.c (gnm_search_replace_cell): Only force strings to
	remain as strings if asked to.
	(gnm_search_replace_class_init): New property
	replace-keep-strings.

	* src/commands.c (cmd_search_replace_do_cell): Fix error
	expression handling to go through expressions.
	(cmd_search_replace_do_cell): Plug leak in make-string case.

2006-04-04  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_cellregion_read): Switch to C locale while
	parsing.  Fixes #337215.

	* src/parser.y (array_exp): Handle explicit "+" sign.

2006-03-31  Morten Welinder  <terra@gnome.org>

	* */*.c: Get rid of VALUE_INTEGER.  It was a nice idea, but
	getting the semantics right meant doing everything twice, in code
	as well as at runtime.  Note, that the magic enum value (30) is
	still understood by value_new_from_string so we can still read old
	xml files.

2006-03-31  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (gcd): Remove.
	* src/sheet-view.c (sv_get_control): Remove.
	* src/stf-parse.c (stf_parse_options_remove_line_terminator): Remove.
	* src/value.c (value_new_error_RECALC, value_array_resize): Remove.

	* src/workbook-view.c (wb_view_sheet_remove): Remove.
	* src/ranges.c (range_adjacent, range_merge, range_is_infinite,
	gnm_sheet_range_dup): Remove.
	* src/sheet-control-gui.c (scg_toplevel): Remove.

	* src/print-info.c (hf_formats_base_num): Make static.
	* src/number-match.c (datetime_locale): Make static.

2006-03-30  Morten Welinder  <terra@gnome.org>

	* */*.c: Use VALUE_IS_STRING, VALUE_IS_ERROR, VALUE_IS_BOOLEAN,
	and VALUE_IS_EMPTY when appropriate.

	* */*.c: Reduce the use of VALUE_INTEGER.
	* parser.y: Fix parser crash for ={-#N/A}.

	* src/expr.c (negate_value): Simplify.
	(bin_arith): Simplify and handler overflow better.

	* src/cell.c (cell_is_zero): Simplify.

	* src/gui-util.c (entry_to_int): Accept floating point values as
	long as they hold integers of the right magnitude.

2006-03-29  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_top_get_array_corner,
	gnm_expr_top_is_array_elem): New functions.

2006-03-29  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* src/libgnumeric.c (gnm_common_init, gnm_shutdown),
	src/number-match-test.c (main): Dropped calls to format_match_init and
	format_match_finish.

2006-03-29  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_finish, format_match_init):
	Remove.

2006-03-28  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (sheet_autofill_dir): Reimplement sanely.
	(autofill_shutdown): New function.

	* src/libgnumeric.c (gnm_shutdown): Hook up autofill_shutdown.

	* src/number-match.c (datetime_locale_setup): Use
	go_date_month_name.

	* src/sheet.c (cb_cell_is_array): Redo in terms of cell_is_array.
	(cb_sheet_cell_copy): Simplify using cell_is_array_corner.

2006-03-28  Eduardo Lima <eduardo.lima@indt.org.br>

	* src/gui-file.c (gui_wb_view_show) : Fixed compile error if defined
	USE_HILDON. Added some comments.
	* src/wbgc-actions.c (cb_file_new) : Fixed compile error if defined
	USE_HILDON. Added some comments. Code cleanup.

2006-03-27  Jody Goldberg <jody@gnome.org>

	* src/value-sheet.c (value_area_get_x_y) : document that this does a
	  cell_eval for range constants.

2006-03-27  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_top_new_array_corner,
	gnm_expr_top_new_array_elem): New function.
	(gnm_expr_new_array_corner, gnm_expr_new_array_elem): Make static.
	All callers changed to _top_ versions.

2006-03-24  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_auto_filter) : adding an autofilter dirties
	  the workbook.

	* src/gui-util.c
	* src/sheet-object-widget.c
	* src/workbook-control-gui.c
	* src/dialogs/dialog-autoformat.c
	* src/dialogs/dialog-stf-preview.c : use g_object_ref_sink if it is
	  available.

	* src/gnm-so-polygon.c (gnm_so_polygon_set_property) : minor safety
	  check.

2006-03-23  Morten Welinder  <terra@gnome.org>

	* src/gnm-datetime.c (datetime_value_to_g): Check validity of
	date.

2006-03-22  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_vector_get_value) : handle blanks without
	  an error.

2006-03-16  Jody Goldberg <jody@gnome.org>

	* Makefile.am : Drop the .server, .keys, and .mime files as obsolete.

2006-03-14  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_dup) : dup the properties too.

2006-03-22  Morten Welinder  <terra@gnome.org>

	* src/validation.c (validation_eval): Clean this up.  Handle
	errors, strings and booleans better.

	* src/sheet-filter.c (filter_expr_eval): Fix last fix.

	* src/validation.c (cb_validate_custom): Use value_compare, not
	value_equal.  Fixes #114086 and makes string match caseless too.

	* src/workbook-control-gui.c (edit_area_button): Set tooltips
	here.
	(wbcg_create_edit_area): Make the line that contains the edit area
	a gtktoolbar so it themes like one.

2006-03-21  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (wb_rel_uri): New function to produce relative
	URIs for inter-workbook references.

2006-03-19  Morten Welinder  <terra@gnome.org>

	* src/value.c (value_diff): Merge integer and floating-point cases
	thus fixing an overflow.

2006-03-18  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_vector_get_value) : init valid to false
	  in case value_coerce_to_number fails and does not set it.

	* src/gnumeric-pane.c (cb_sheet_object_view_destroyed) : handle life
	  cycle change.

2006-03-18  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-pane.c (cb_sheet_object_view_destroyed): Fix crash
	exposed by foocanvas fixes.  [#335052]

	* src/mathfunc.c (combin, permut): Changed parameter types to
	gnm_float.

	* src/parse-util.c (wbref_parse): Take reference wb in case a URI
	is relative.  All callers changed.

	* src/application.c (cb_workbook_uri): Renamed from
	cb_workbook_name.
	(gnm_app_workbook_get_by_uri): Renamed from
	gnm_app_workbook_get_by_name.
	(gnm_app_workbook_get_by_name): New function that tries URI,
	absolute filename, and relative URI.

2006-03-17  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnm_app_workbook_get_by_index,
	gnm_app_workbook_get_by_name): s/close/closure/.  (The former is
	reserved by libc.)
	(cb_workbook_index): Actually set a result.

	* src/item-edit.c (item_edit_dispose): Rename from
	item_edit_finalize and hook up as such.  Otherwise it may not get
	run.
	* src/item-bar.c (item_bar_dispose): Ditto.

	* src/preview-grid.c (preview_grid_dispose): Rename from
	preview_grid_destroy and hook up as such.

2006-03-16  Morten Welinder  <terra@gnome.org>

	* src/style-border.h (STYLE_BORDER_LOCATION_TO_STYLE_ELEMENT): New
	translation macro that produces a value of the right type.

	* src/wbc-gtk.c (cb_border_activated): Use STYLE_BORDER_LEFT, not
	MSTYLE_BORDER_LEFT, for argument to style_border_get_orientation!
	Ditto for _RIGHT.

	* src/cell.c (cell_copy): Silence a "sparse" warning.

	* src/wbcg-actions.c (wbcg_set_selection_valign): Compare valign
	with the result of gnm_style_get_align_v, not
	gnm_style_get_align_h.

	* src/cell.h (cell_eval): Fix "sparse" warning and add "do { }
	while(0)" wrapper.

	* src/auto-format.c (do_af_suggest): Don't compare value types
	against GNM_EXPR_OP_ARRAY_CORNER and GNM_EXPR_OP_ARRAY_ELEM.

	* src/gnm-style-impl.h (GnmStyle): The v_align is not of type
	GnmHAlign. Really.

	* src/xml-sax-read.c (xml_sax_object_start): Use NULL, not FALSE.
	* src/xml-io.c (xml_read_sheet_object): Ditto.
	* src/expr.c (gnm_expr_top_is_err): Ditto.

2006-03-15  Morten Welinder  <terra@gnome.org>

	* src/collect.c (float_range_function2): When things are being
	stripped away, adjust the number of data pairs.  Fixes #334591.

2006-03-14  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_rewrite): Use gnm_expr_new_funcallv and
	gnm_expr_new_setv.
	(gnm_expr_new_funcallv, gnm_expr_new_setv): New functions.
	(gnm_expr_free): Renamed from gnm_expr_unref.  Always to deep
	free.  All callers changed.
	(gnm_expr_copy): Deep copy.

	* src/clipboard.c (paste_cell_with_operation): Build a regular
	expressions.  No hacks.

	* src/collect.c (collect_floats): When collecting info, walk over
	blanks too.

	* src/expr.c (gnm_expr_top_unwrap): Remove.  All callers changed.

	* src/preview-grid.c (preview_grid_destroy): Renamed from
	preview_grid_finalize and hooked up as destroy handler.  This
	breaks ref cycles and thus plugs leaks.

2006-03-13  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_sheet_read): Handle "protected" attribute.
	* src/xml-sax-read.c (xml_sax_sheet_start): Ditto.
	* src/xml-sax-write.c (xml_write_sheet): Ditto.
	Patch from Klokan Petr Pridal.  [#334257]

2006-03-11  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-write.c (xml_write_cell_and_position): Wow.  Botched
	every single expression and every single value.

2006-03-10  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_sendto) : minor warning suppression.

2006-03-10  Morten Welinder  <terra@gnome.org>

	* src/expr.h (GnmExprTop): New type for top-level expressions.
	* src/clipboard.h (GnmCellCopy): Use a top-level expression here.
	Rename it to "texpr" to make sure we catch all users.  All users
	changed.
	* src/dependent.h (GnmDependent): Ditto.
	* src/expr-name.h (GnmNamedExpr): Ditto.
	* src/style-conditions.h (GnmStyleCond): Ditto.
	* src/validation.h (GnmValidation): Ditto.

	* src/expr.c (gnm_expr_top_new, gnm_expr_top_new_constant,
	gnm_expr_top_ref, gnm_expr_top_unref, gnm_expr_top_unwrap,
	gnm_expr_top_is_shared, gnm_expr_top_is_err,
	gnm_expr_top_is_rangeref, gnm_expr_top_get_constant,
	gnm_expr_top_contains_subtotal, gnm_expr_top_referenced_sheets,
	gnm_expr_top_first_funcall, gnm_expr_top_get_boundingbox,
	gnm_expr_top_rewrite, gnm_expr_top_get_ranges, gnm_expr_top_equal,
	gnm_expr_top_as_string, gnm_expr_top_as_gstring,
	gnm_expr_top_eval, gnm_expr_top_get_ranges): New functions.  Many
	non-top versions made static.
	(gnm_expr_copy): New function replacing gnm_expr_ref.  (Still
	simply refs, but not for long.)

	*/*.c: Massive changes adapting to the above.

	* src/rendered-value.c (rendered_value_recontext): Make sure
	wrap_text is only cleared when we clear the layout's width.
	Fixes #334144.

2006-03-09  Morten Welinder  <terra@gnome.org>

	* src/sheet-filter.c (filter_expr_eval): Take GnmCell instead of
	its value for target.  Use formatted value in !src case.
	(filter_expr_init): String EQ and NE should not coerce to number.
	(collect_unique_elements): Limit menu text length.  Change hash
	key to formatted value instead of value.  Store formatted value,
	not GnmValue, in model.
	All this fixes #333809.

2006-03-06  Morten Welinder  <terra@gnome.org>

	* src/collect.c (callback_function_collect): Rename COLLECT_DATES
	flags to COLLECT_COERCE_STRINGS and make it make all kinds of
	strings.  All callers changed.

	* configure.in (ALL_LINGUAS): Undo last change -- it breaks the
	build.  "id" can go back when there is a po-functions translation
	too.
	(CFLAGS): Drop -Wmissing-format-attribute.

2006-03-06  Ahmad Riza H Nst  <rizahnst@eriagempita.co.id>

	* po/id.po: Added Indonesian translation, done by Imam Musthaqim <imam@infoflow.co.id>
	* configure.in: Added "id" (Indonesian) to the ALL_LINGUAS line.
			
2006-03-03  Eduardo Lima  <eduardo.lima@indt.org.br>

	* src/dialogs/dialog-doc-metadata.c: Code reformulation.
	* src/dialogs/doc-meta-data.glade: Adjusted some properties.
	* src/dialogs/help.h: defined GNUMERIC_HELP_LINK_METADATA.

2006-03-02  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_focus): Update menu
	feedback here for the case where a pristine workbook is replaced.

2006-03-01  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Fix zoom issue #332932.

2006-02-27  Morten Welinder  <terra@gnome.org>

	* src/expr.c (do_gnm_expr_unref): Plug leaks.

2006-02-26  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_create): Attach to notify::uri
	and notify::dirty in order to control window title.

	* src/workbook-control.c (wb_control_update_title): Remove.

	* src/workbook-control-priv.h (WorkbookControl): Remove
	"set_title" member.

	* src/commands.c (GnmCommand): Add "workbook_modified_before_do"
	member.
	(command_undo): If !workbook_modified_before_do, mark the workbook
	not modified after undo.
	(command_push_undo, command_redo): Setup
	workbook_modified_before_do.

	* src/workbook-priv.h: Add "pristine" member.

	* src/sheet.h (Sheet): Remove "modified" and "pristine" members.

	* src/sheet.c (sheet_mark_dirty): Renamed from sheet_set_dirty.
	Always mark dirty, so kill last argument.  All callers changed.

	* src/workbook.c (workbook_get_property, workbook_set_property):
	New functions.
	(workbook_class_init): Install workbook_get_property and
	workbook_set_property.  Install new properties "uri" and "dirty".
	Remove FILENAME_CHANGED signal and fix callers to use notify::uri.
	(workbook_sheet_add): Drop dirty argument.  Adding a sheet always
	dirties the workbook.  All callers changed.
	(workbook_mark_not_modified): New function.
	(workbook_set_dirty, workbook_is_dirty): Maintain a simply
	"modified" flag.
	(workbook_is_pristine): Maintain a simple workbook-level
	"pristine" flag.
	(workbook_set_placeholder, workbook_is_placeholder): Remove.
	(workbook_new_with_sheets): After adding sheets, mark workbook not
	modified and pristine.
	(workbook_sheet_attach_at_pos): Mark workbook dirty.
	(workbook_sheet_delete): Except during workbook destruction, mark
	workbook dirty.

2006-02-24  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_remove): Simplify.
	(wbcg_get_scg): Rename from wbcg_sheet_to_page_index and changed
	to return the scg only.  Make static.  All callers changed.

	* src/workbook.c (workbook_sheet_remove_controls): Renamed from
	workbook_sheet_hide_controls.
	(cb_sheet_visibility_change): Remove.  The workbook doesn't care
	about sheet visibility.

	* src/workbook-control-gui.c (wbcg_sheet_add): Set
	SHEET_CONTROL_GUI here.  Do everything here for invisible sheets
	too, but hide the table widget.  Attach signals for visibility
	[new] and sheet tabs here, not in wbcg_sheet_focus.
	(disconnect_sheet_signals): Take an extra argument to control
	whether to clear all signals or just those for the active sheet.
	All callers changed.
	(cb_sheet_label_button_press): Use the scg for data and simplify.
	(wbcg_sheet_remove_all): Disconnect signals for all sheets.  Use
	gtk_widget_destroy to get rid of the page.
	(wbcg_page_index_to_sheet): Remove.  Expand left-over bits to
	callers.
	(wbcg_sheet_to_page_index): Simplify now that sheets are 1-1 with
	tabs.

	* src/sheet-control-gui.c (sheet_control_gui_new): Don't set
	SHEET_CONTROL_KEY here.

	* src/workbook-control-gui.c (SHEET_CONTROL_KEY): Move to here.
	* src/sheet-control-gui.h (SHEET_CONTROL_KEY): From here.

2006-02-23  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_start): Go to the end of the
	text.  Fixes #319311.

	* src/workbook-control-gui.c (edit_area_button): Use tool buttons,
	not plain buttons.  Fixes #331916.

2006-02-22  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_new_set): Don't unref the args, just free
	the list.

2006-02-21  Morten Welinder  <terra@gnome.org>

	* src/func.h (GnmFuncNodes) Switch to argc/argv mode.  All, and I
	mean all, users changed.

	* src/collect.c (float_range_function, string_range_function):
	Switch to argc/argv mode.  All callers changed.
	* src/func.c (function_iterate_argument_values): Ditto.

2006-02-19  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_new_funcall1, gnm_expr_new_funcall2,
	gnm_expr_new_funcall3): New functions.

	* src/parser.y (build_logical): Use gnm_expr_new_funcall2.
	(build_not): Use gnm_expr_new_funcall1.

2006-02-19  Morten Welinder  <terra@gnome.org>

	* src/expr-impl.h (GnmExprFunction, GnmExprSet): Replace
	expression list by argc/argv members.  All users fixed.

	* src/func.c (function_call_with_exprs): Renamed from
	function_call_with_list and changed to argc/argv input.  All
	callers changed.

	* src/auto-format.c (do_af_suggest_list): Changed to argc/argv
	input.  All callers changed.

	* src/expr.c (gnm_expr_list_equal, gnm_expr_list_eq): Remove.

	* src/mstyle.c (gnm_style_dump): Dump non-localized format.

2006-02-18  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (toolbar_context_menu): Add an entry to hide the
	toolbar.

	* src/gnumeric-gconf.c (gnm_gconf_get_toolbar_position,
	gnm_gconf_set_toolbar_position): New functions.

	* src/wbc-gtk.c (cb_add_menus_toolbars): Load initial toolbar
	positions from gconf.
	(set_toolbar_position): Store toolbar positions in gconf.

2006-02-17  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init): Initialize three toolbar zones.
	(cb_add_menus_toolbars): Attach context menus to the toolbars and
	their handlebox.
	(set_toolbar_position, cb_set_toolbar_position,
	toolbar_context_menu, cb_toolbar_button_press,
	cb_handlebox_button_press): New functions implementing the toolbar
	context menu.
	(create_undo_redo): Create actions for vertical mode too.
	(toolbar_context_menu): Present a different menu when detached.

2006-02-16  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init_font_name): Set a stock id to avoid
	critical on very narrow windows.
	(wbc_gtk_init_font_size): Ditto, but throw in a label also.

2006-02-15  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init): Update undo/redo labels here
	before checking for duplicate keys.  This avoid #324692.

	* src/ssconvert.c (main): Don't compare argv with 3.  Really.

	* src/workbook-edit.c (wbcg_edit_start): Don't compare gboolean
	and pointers.

2006-02-14  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_time): Handle hhmmss.sss,
	hhmmss, hhmm, mmss, and mmss.ss.  (All with no separators.)
	(handle_year): Map missing year to current year.
	(format_match_datetime): Handle yearless dates.  Handle
	20041224:121213.

2006-02-12  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_datetime): Loosen the separator
	requirements when alphabetic month is being used.  Fixes #56168.

2006-02-12  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_simple): Don't bother parsing
	as int first.
	(format_match): Redo.  No longer uses canned formats.

2006-02-06  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (random_binomial): Make trial argument a
	gnm_float for increased range.
	(random_negbinom, random_hypergeometric): Similarly.

2006-02-05  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (main): Convert to GOption.
	* src/ssindex.c (main): Convert to GOption.

2006-02-04  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (gutils_init): Solver messages have no business
	here.
	* src/solver.h (SOLVER_MAX_TIME_ERR): Define here.

	* src/main-application.c (gnumeric_arg_parse): Plug leak.

2006-02-03  Eduardo Lima  <eduardo.lima@indt.org.br>

	* src/main-application.c (gnumeric_arg_parse): Call gnome_vfs_init()
	if defined USE_HILDON.
	(main): Call osso_initialize() and osso_deinitialize()
	* src/wbcg-actions.c (actions): 
	Inserted macros for "ViewFullScreen", "ViewZoomIn" and "ViewZoomOut"
	accelerators. 
	* src/HILDON_Gnumeric-gtk.xml.in: Removed File->Print.
	Removed View->Zoom.
	Inserted View->Zoom In.
	Inserted View->Zoom Out.

2006-02-03  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (gnumeric_arg_parse): Switch to GOption
	infrastructure.

2006-02-01  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (std_sheet_name_quote, std_name_parser): New
	functions.
	(gnm_expr_conventions_new): Hook these up.

	* src/parser.y (yylex): Use convs->name_parser.

	* src/parse-util.h (GnmExprConventions): Replace
	unquoted_ascii_name_chars member by sheet_name_quote and
	name_parser members.
	(gnm_expr_conv_is_unquoted_char): Remove.

2006-01-30  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (sheetref_parse): Underscore is a letter for
	this purpose.

2006-01-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=327278
	* src/gnumeric-gconf-priv.h (GNM_CONF_SORT_DEFAULT_HAS_HEADER): new
	* src/gnumeric-gconf.c (gnm_gconf_set_sort_has_header): new
	(gnm_conf_init_extras): initialize prefs.sort_default_has_header
	* src/gnumeric-gconf.h (gnm_gconf_set_sort_has_header): new
	(GnmAppPrefs): add sort_default_has_header field
	* src/wbcg-actions.c (sort_by_rows): skip header if the preferences
	  indicate that
	* schemas/gnumeric-general.schemas.in: add sort/default/has-header
	  schema

2006-01-24  Morten Welinder  <terra@gnome.org>

	* src/item-cursor.c (item_cursor_draw): Revert previous change.
	It breaks my system by making the dragging-the-little-square
	operation blind.

2006-01-24  Morten Welinder  <terra@gnome.org>

	* src/gnm-datetime.c (datetime_value_to_seconds): Kill.

2006-01-23  Morten Welinder  <terra@gnome.org>

	* src/expr.c (expr_init): Create two pools: one for small and one
	for large nodes.

	* src/expr-impl.h (GnmExpr): Merge oper and ref_count fields into
	one oper_and_refcount field.  Define accessors GNM_EXPR_GET_OPER
	and GNM_EXPR_GET_REFCOUNT.  All users changed.

2006-01-22  Jody Goldberg <jody@gnome.org>

	* src/expr-impl.h : arrays cannot be larger than 2^32 even on 64 bit
	  architectures.

2006-01-21  Morten Welinder  <terra@gnome.org>

	* src/parse-util.h (struct _GnmExprConventions): Replace
	ignore_spaces by new intersection_char member.  All users fixed.

	* src/parser.y (yylex): Handle RANGE_INTERSECTION as symbolic
	token by translating space or whatever to that.

	* src/parse-util.c (gnm_expr_conventions_new): Default
	intersection char is space.

	* src/expr.c (do_expr_as_string): Append the right intersection
	operator.

2006-01-21  Morten Welinder  <terra@gnome.org>

	* gnumeric.desktop.in (Categories): Add Math, Science, GNOME, GTK.

2006-01-21  Jody Goldberg <jody@gnome.org>

	* src/auto-format.c (do_af_suggest) : handle new GNM_EXPR_OP_ARRAY
	  mechanisms.
	* src/clipboard.c (cb_clipboard_prepend_cell) : ditto.
	* src/cmd-edit.c (sv_select_cur_array) : ditto.
	* src/dependent.c (link_expr_dep) : ditto.
	(unlink_expr_dep) : ditto.
	* src/expr-name.c (expr_name_check_for_loop) : ditto.
	* src/expr.c (gnm_expr_new_array_corner) : new,
	(gnm_expr_new_array_elem) : new.
	(gnm_expr_new_array) : delete.
	(do_gnm_expr_unref) : handle new mechanism.
	(gnm_expr_eval) : ditto.
	(gnm_expr_equal) : ditto.
	(do_expr_as_string) : ditto.
	(gnm_expr_rewrite) : ditto.
	(gnm_expr_first_func) : ditto.
	(do_referenced_sheets) : ditto.
	(gnm_expr_containts_subtotal) : ditto.
	(gnm_expr_get_boundingbox) : ditto.
	(gnm_expr_is_rangeref) : ditto.
	(ets_hash) : ditto.
	(expr_tree_sharer_share) : ditto.
	(gnm_expr_is_array) : delete.
	(array_elem_get_corner) : new.

	* src/cell.c (cell_is_array) : ditto.
	(cell_array_bound) : new.
	(cell_is_array_corner) : new.
	(cell_is_nonsingleton_array) : renamed from cell_is_partial_array.
	(cell_has_comment) : delete.

	* src/sheet.c (sheet_get_comment) : renamed from cell_has_comment_pos

2006-01-21  Jody Goldberg <jody@gnome.org>

	* configure.in : adjust to new goffice versioning

2006-01-19  Ivan, Wong Yat Cheung  <ivanwong@gnome.org>

	* src/Makefile.am: Build as non-console Win32 application by default.

	* src/main-application.c (main): Attach to an existing console (only 
	if there is one)

	* src/item-cursor.c (item_cursor_draw): Use GDK_XOR which is more
	common than GDK_EQUIV for drawing item cursor. Fixes #314210.

2006-01-13  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_general): Drop maxline argument.  All
	callers changed.

	* src/commands.c (cmd_text_to_columns): Plug leaks.

2006-01-06  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_search_replace_update_after_action): Add wbc
	argument and pass it on to update_after_action.  All callers
	changed.
	(cmd_search_replace_do): Add wbc argument and pass it on to
	cmd_search_replace_update_after_action.  All callers changed.

2006-01-02  Stepan Kasal  <kasal@ucw.cz>

	* schemas/gnumeric-dialogs.schemas.in (unfocused): Fix a typo
	  in the description.

2005-12-28  Jody Goldberg <jody@gnome.org>

	* src/workbook.c : Move to GsfDocMetaData

	* src/commands.c (cmd_change_meta_data*) : re-work for new metadata
	  structure.

	* src/Makefile.am : remove the defunct summary.[ch]

	* src/GNOME_Gnumeric-gtk.xml.in : enable the new dialog in place of
	  the old one.
	* src/wbcg-actions.c : ditto.

2005-12-22  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_cells): Remove the variables orphaned by
	the previous Stepan's change.

2005-12-22  Stepan Kasal  <kasal@ucw.cz>

	* src/sheet-filter.c (cell_value_cmp): Fix "const" warning.

	* src/workbook.c (workbook_cells): Use WORKBOOK_FOREACH_SHEET, not
	workbook_sheets.

2005-12-21  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_call_with_list): Eliminate 'B'.  It was
	identical to 'E'.
	(function_def_get_arg_type_string): Ditto.

2005-12-13  Morten Welinder  <terra@gnome.org>

	* src/parser.y (build_set): Make this function unregister argument
	on success like all the other build_* functions.  Fix caller to
	not leak in error case.  Fixes #301127.

2005-12-13  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_read_scenarios): Plug leak.

	* src/xml-sax-write.c (xml_write_scenarios): Add missing
	gsf_xml_out_end_element corrupting files.

2005-12-12  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (sog_gsf_gdk_pixbuf_save): removed.
	(gnm_sog_write_image): use gog_graph_export_image API.
	(sog_cb_save_as): use gog_graph_get_supported_image_formats API.
	Format is an enum now.
	* src/sheet-object-image.c (soi_get_image_fmt): removed. It's in
	goffice now. 
	(soi_free_image_fmt): removed.
	(gnm_soi_write_image): use go_image_get_formats_with_pixbuf_saver API.

2005-12-12  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_node_get_value): Add protections against file
	corruption.  Fixes crash from #323888.

2005-12-11  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.[ch] (x_store_clipboard_if_needed): New
	function. Hand clipboard off to clipboard manager if this is the
	last remaining wbcg.

	* src/gui-clipboard.c (table_cellregion_write): Replace wbc
	parameter with a command context.
	(image_write, graph_write): Remove sheet parameter.
	(x_clipboard_get_cb): We're no longer passed a wbcg. Instead,
	create a temporary command context. Test output from
	gnm_cellregion_to_xml before using. Use workbook_date_conv from
	workbook of clipboard's origin_sheet.
	(x_clipboard_clear_cb): Simplify.
	(x_claim_clipboard): Register x_clipboard_clear_cb only for
	CLIPBOARD, not for PRIMARY. Call gtk_clipboard_set_can_store,
	indicating that we can hand clipboard off to clipboard manager
	when exiting.

	* src/workbook-control-gui.c (wbcg_finalize): Call
	x_store_clipboard_if_needed.

2005-12-09  Morten Welinder  <terra@gnome.org>

	* templates/english/loan.gnumeric: Replace BOLT.  (Boring Old Loan
	Template.)  Supplied by Philo Vivero.  #317201.

2005-12-08  Jody Goldberg <jody@gnome.org>

	* src/parse-util.c (gnm_expr_conventions_new) : assign a std set of
	  ascii characters that do not require quoting.
	(gnm_expr_conv_quote) : renamed from

2005-12-08  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_def_get_arg_type_string): Note, that 'B'
	accepts errors too.
	(function_call_with_list): Fix last fix.

	* src/parse-util.c (sheetref_parse): Handle sheet names starting
	with digits.

	* src/sheet.c (sheet_name_quote): Simplify and handle non-initial
	dot.

2005-11-30  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_call_with_list): Fix handling of strings
	for 'b' argument types.  We only want TRUE/FALSE, not dates and
	numbers in strings.

	* src/commands.c (cmd_set_text): Plug leak.

	* src/value.c (value_new_from_string): Factor out boolean parsing
	into value_parse_boolean.
	(value_get_as_bool): Use value_parse_boolean.  This changes
	semantics so that only "TRUE" and "FALSE" (ignoring case) are valid
	values.

2005-12-01 Eduardo Lima <eduardo.lima@indt.org.br>

	* wbcg-actions.c (cb_view_zoom_in): Changed name to cb_view_zoom_out.
	(cb_view_zoom_out): Changed name to cb_view_zoom_in.

2005-11-30 Eduardo Lima <eduardo.lima@indt.org.br>

	* src/workbook-control-gui.c (wbcg_finalize:1665): Fixed compile
	error in Maemo Platform.

2005-11-28  Morten Welinder  <terra@gnome.org>

	* src/sheet-filter.c (cb_collect_unique): Map value to cells.
	(cb_hash_range): Renamed from cb_copy_hash_to_array.  Changed to
	collect values (i.e., cells) , not keys (i.e., values).
	(collect_unique_elements): Format values for display.  Fixes
	#322392.

2005-11-18  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-pane.c (cb_control_point_event): begin drag mode even
	for created object.

2005-11-18  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (gnm_sog_write_image): don't use pixbuf
	directly, but use helpers function from goffice/graph/gog-renderer.c,
	in order to ease testing of goffice cairo renderer.
	(sheet_object_graph_set_gog): ditto.

2005-11-15  Stepan Kasal  <kasal@ucw.cz>

	* README: Fix the goffice requirement.
	* src/application.c (gnm_app_workbook_list_add): Fix the comment.

2005-11-14  Jody Goldberg <jody@gnome.org>

	* configure.in : Post BRANCH bump
	  re-enable the disable_deprecated flags
